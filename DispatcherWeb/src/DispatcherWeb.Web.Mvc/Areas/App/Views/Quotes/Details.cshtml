@using System.Threading.Tasks
@using Abp.Configuration
@using DispatcherWeb.Authorization
@using DispatcherWeb.Quotes.Dto
@using DispatcherWeb.Web.Areas.App.Startup
@using DispatcherWeb.Configuration
@{
    ViewBag.CurrentPageName = AppPageNames.Tenant.Quotes;
}
@model QuoteEditDto

@section Scripts{
    <environment names="Development">
        <script src="~/view-resources/Areas/app/Views/Quotes/_CreateOrEditQuoteServiceModal.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Customers/_CreateOrEditCustomerModal.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Customers/_CreateOrEditCustomerContactModal.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Common/Modals/_MergeModal.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Quotes/Details.js" asp-append-version="true"></script>
    </environment>

    <environment names="Staging,Production">
        <script src="~/view-resources/Areas/app/Views/Quotes/_CreateOrEditQuoteServiceModal.min.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Customers/_CreateOrEditCustomerModal.min.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Customers/_CreateOrEditCustomerContactModal.min.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Common/Modals/_MergeModal.min.js" asp-append-version="true"></script>
        <script src="~/view-resources/Areas/app/Views/Quotes/Details.min.js" asp-append-version="true"></script>
    </environment>

}

<div class="m-subheader ">
    <div class="row align-items-center">
        <div class="mr-auto col-sm-12 col-lg-4 text-center text-lg-left">
            <h3 class="m-subheader__title m-subheader__title--separator">
                <span>@L("QuoteDetailHeader")</span>
            </h3>
            <span class="m-section__sub">
                @L("QuoteDetailHeaderInfo")
            </span>
        </div>
        <div class="mr-auto-btn col-sm-12 col-lg-8 text-center text-lg-right">
            @if (IsGranted(AppPermissions.Pages_Quotes_Edit))
            {
                <button id="CreateNewQuoteButton" class="btn btn-primary"><i class="fa fa-plus"></i> @L("AddQuote")</button>
                <button id="CopyQuoteButton" class="btn btn-primary"><i class="fa fa-copy"></i> @L("CopyQuote")</button>
            }
            <button id="PrintQuoteButton" class="btn btn-primary"><i class="fa fa-print"></i> @L("PrintQuote")</button>
            @if (IsGranted(AppPermissions.Pages_Quotes_Edit))
            {
                <button id="EmailQuoteButton" class="btn btn-primary"><i class="fa fa-envelope"></i> @L("EmailQuote")</button>
            }

        </div>
    </div>
</div>
<div class="m-content">

    <div class="m-portlet m-portlet--tab">
        <div class="m-portlet m-portlet--last m-portlet--head-lg m-portlet--responsive-mobile">
            <form id="QuoteForm" asp-controller="Quotes" asp-action="Details" class="m-form m-form--fit m-form--label-align-right">
                <input type="hidden" asp-for="ProjectId" />


                <div class="m-portlet__body">
                    @if (IsGranted(AppPermissions.Pages_Projects))
                    {
                        <div class="form-group m-form__group row">
                            <label for="ProjectName" class="col-sm-12 col-md-2 col-form-label mb-2">@L("ProjectName"):</label>
                            <div class="col-sm-12 col-md-5 col-lg-6 mb-2">
                                <input type="text" readonly class="form-control m-input" asp-for="ProjectName">
                            </div>
                            <div class="col-sm-12 col-md-5 col-lg-4 mb-2">
                                <div id="projectRelatedButtons" @Html.StyleDisplayNone(!Model.ProjectId.HasValue)>
                                        <button type="button" class="btn btn-default" id="GoToProjectButton"><i class="fa fa-reply"></i> @L("GoToProject")</button>
                                        <button type="button" class="btn btn-default" id="RemoveProjectButton"><i class="fa fa-minus-circle"></i> @L("RemoveProject")</button>
                                </div>
                                <div id="noProjectButtons" @Html.StyleDisplayNone(Model.ProjectId.HasValue)>
                                    <button type="button" class="btn btn-default" id="AddToProjectButton"><i class="fa fa-plus-circle"></i> @L("AddToProject")</button>
                                </div>
                            </div>
                        </div>
                    }
                    <div class="form-group m-form__group row">
                        <label for="Name" class="col-sm-12 col-md-2 col-form-label">@L("QuoteId"):</label>
                        <div class="col-sm-12 col-md-10">
                            <input type="text" class="form-control m-input" asp-for="Id" readonly>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label for="Name" class="col-sm-12 col-md-2 col-form-label pg-add required-label">@L("Name"):</label>
                        <div class="col-sm-12 col-md-10">
                            <input type="text" class="form-control m-input" asp-for="Name" required>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label pg-add">@L("Description"):</label>
                        <div class="col-sm-12 col-md-10">
                            <input type="text" class="form-control m-input" asp-for="Description">
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label asp-for="ProposalDate" class="col-sm-12 col-md-2 col-form-label">@L("ProposalDate"):</label>
                        <div class="col-sm-12 col-md-2">
                            <input type="text" class="form-control m-input" asp-for="ProposalDate">
                        </div>
                        <label asp-for="ProposalExpiryDate" class="col-sm-12 col-md-2 col-form-label">@L("ProposalExpiryDate"):</label>
                        <div class="col-sm-12 col-md-2">
                            <input type="text" class="form-control m-input" asp-for="ProposalExpiryDate">
                        </div>
                        <label asp-for="InactivationDate" class="col-sm-12 col-md-2 col-form-label">@L("InactivationDate"):</label>
                        <div class="col-sm-12 col-md-2">
                            <input type="text" class="form-control m-input" asp-for="InactivationDate">
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label required-label pg-add">@L("Customer"):</label>
                        <div class="col-sm-12 col-md-10">
                            <select class="form-control" asp-for="CustomerId" disabled="@(Model.HasOrders ? "disabled" : null)">
                                <option value="">Select a customer</option>
                                @if (Model.CustomerId != 0)
                                {
                                    <option selected value="@Model.CustomerId">@Model.CustomerName</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label pg-add">@L("Contact"):</label>
                        <div class="col-sm-12 col-md-10">
                            <select class="form-control" asp-for="ContactId">
                                <option value=""
                                        data-placeholder-default="Select a contact"
                                        data-placeholder-no-items="No contacts defined for the selected customer"
                                        data-placeholder-no-parent="Select a customer first">
                                    Select a contact
                                </option>
                                @if (Model.ContactId.HasValue)
                                {
                                    <option selected value="@Model.ContactId">@Model.ContactName</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label pg-add">@L("Status"):</label>
                        <div class="col-lg-2 col-sm-12 col-md-10">
                            <select class="form-control" asp-for="Status" asp-items="Html.GetEnumSelectList<QuoteStatus>()">
                                <option value="">Select an option</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label pg-add required-label">@L("Salesperson"):</label>
                        <div class="col-lg-2 col-sm-12 col-md-10">
                            <select class="form-control" asp-for="SalesPersonId" required>
                                <option value="">Select a salesperson</option>
                                @if (Model.SalesPersonId.HasValue)
                                {
                                    <option selected value="@Model.SalesPersonId">@Model.SalesPersonName</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-lg-2 col-sm-12 col-md-2 col-form-label" for="PONumber">@L("PONumber"):</label>
                        <div class="col-lg-2 col-sm-12 col-md-3 col-xs-9">
                            <input type="text" class="form-control" asp-for="PONumber">
                        </div>
                    </div>


                    <div class="box-header-top clearfix">
                        <div class="grid-caption pull-left">
                            <label>@L("QuoteItems")</label>
                        </div>
                        <div class="box-actions pull-right mr-neg-10">
                            @if (IsGranted(AppPermissions.Pages_Quotes_Items_Create))
                            {
                                <button type="button" class="btn btn-default" id="CreateNewQuoteServiceButton"><i class="fa fa-plus"></i>@L("AddQuoteItem")</button>
                            }
                            @if (IsGranted(AppPermissions.Pages_Quotes_Edit))
                            {
                                <button type="button" class="btn btn-default" id="DeleteSelectedQuoteServicesButton" disabled><i class="fa fa-trash"></i>@L("Delete")</button>
                            }
                        </div>
                    </div>
                    <table class="table table-striped table-bordered table-hover dt-responsive" id="QuoteServicesTable"></table>

                    <div class="row" @Html.StyleDisplayNone(!await SettingManager.GetSettingValueAsync<bool>(AppSettings.Fuel.ShowFuelSurcharge))>
                        <div class="col-lg-4 col-md-6">
                            <div class="form-group m-form__group row">
                                <label class="col-lg-6 col-md-6 col-sm-12 col-form-label" for="FuelSurchargeCalculation">@L("FuelSurchargeCalculation"):</label>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <select class="form-control" asp-for="FuelSurchargeCalculationId">
                                        <option value="">@AppConsts.FuelSurchargeCalculationBlankName</option>
                                        @if (Model.FuelSurchargeCalculationId > 0)
                                        {
                                            <option selected value="@Model.FuelSurchargeCalculationId">@Model.FuelSurchargeCalculationName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6" id="BaseFuelCostContainer" @Html.StyleDisplayNone(Model.CanChangeBaseFuelCost != true)>
                            <div class="form-group m-form__group row">
                                <label class="col-sm-12 col-lg-4 col-md-6 col-form-label" for="BaseFuelCost">@L("BaseFuelCost"):</label>
                                <div class="col-sm-12 col-lg-4 col-md-6">
                                    <input type="text" class="form-control" asp-for="BaseFuelCost" data-rule-number="true" data-rule-min="0" data-rule-max="@AppConsts.MaxDecimalDatabaseLength" data-msg-number="Must be a numeric value">
                                </div>
                            </div>
                        </div>
                    </div>
                    @if (Session.OfficeCopyChargeTo)
                    {
                        <div class="form-group m-form__group row">
                            <label class="col-sm-12 col-md-2 col-form-label">@L("ChargeTo"):</label>
                            <div class="col-sm-12 col-md-10">
                                <input type="text" class="form-control" asp-for="ChargeTo">
                            </div>
                        </div>
                    }
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label">@L("Comments"):</label>
                        <div class="col-sm-12 col-md-10">
                            <textarea class="form-control" rows="5" asp-for="Directions"></textarea>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label"></label>
                        <div class="col-sm-12 col-md-10">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    @L("InsertCannedText") <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu insert-canned-text-list" data-target-id="Notes">
                                    <li data-id="loading" style="display: none;"><a href="#">Loading...</a></li>
                                    <li data-id="no-items" style="display: none;"><a href="#">No items</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="form-group m-form__group row">
                        <label class="col-sm-12 col-md-2 col-form-label">@L("Notes"):</label>
                        <div class="col-sm-12 col-md-10">
                            <textarea class="form-control" rows="5" asp-for="Notes"></textarea>
                        </div>
                    </div>

                </div>
                <div class="m-portlet__foot m-portlet__foot--fit">
                    <div class="m-form__actions">
                        <button type="submit" class="btn btn-primary" id="SaveQuoteButton">@L("Save")</button>
                    </div>
                </div>

            </form>
        </div>
    </div>


    @*<div class="m-portlet m-portlet--mobile">
        <div class="m-portlet__head">
            <div class="m-portlet__head-caption">
                <div class="m-portlet__head-title">
                    <h3 class="m-portlet__head-text">
                        @L("QuoteItems")
                    </h3>
                </div>
            </div>
            <div class="m-portlet__head-tools">
                <ul class="m-portlet__nav">
                    @if (IsGranted(AppPermissions.Pages_Quotes_Items_Create))
                    {
                        <li class="m-portlet__nav-item">
                            <button type="button" class="btn btn-default" id="CreateNewQuoteServiceButton"><i class="fa fa-plus"></i>@L("AddQuoteItem")</button>
                        </li>
                    }
                    @if (IsGranted(AppPermissions.Pages_Quotes_Edit))
                    {
                        <li class="m-portlet__nav-item">
                            <button type="button" class="btn btn-default" id="DeleteSelectedQuoteServicesButton" disabled><i class="fa fa-trash"></i>@L("Delete")</button>
                        </li>
                    }
                </ul>
            </div>
        </div>
        <div class="m-portlet__body pt-0">
            <div class="box-body">
                <table class="table table-striped table-bordered table-hover dt-responsive" id="QuoteServicesTable"></table>
            </div>
        </div>
    </div>*@

    <div class="m-portlet m-portlet--mobile editing-only-block" style="@(Model.Id > 0 ? "" : "display:none")">
        <div class="m-portlet__head">
            <div class="m-portlet__head-caption">
                <div class="m-portlet__head-title">
                    <h3 class="m-portlet__head-text">
                        @L("History")
                    </h3>
                </div>
            </div>
        </div>
        <div class="m-portlet__body pt-0">
            <div class="box-body">
                <br />
                <table class="table table-striped table-bordered table-hover dt-responsive" id="QuoteHistoryTable"></table>
            </div>
        </div>
    </div>
</div>
